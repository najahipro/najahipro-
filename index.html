<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO Meta Tags -->
    <title>najahipro - حاسبة المعدل الدراسي | النظام التعليمي المغربي</title>
    <meta name="description" content="احسب معدلك الدراسي بسهولة مع najahipro. حاسبة معدل شاملة للجذع المشترك، البكالوريا الأولى والثانية. مجاني 100% للطلاب المغاربة.">
    <meta name="keywords" content="حاسبة المعدل, المعدل الدراسي, البكالوريا المغرب, الجذع المشترك, حساب النقاط, najahipro, تعليم المغرب">
    <meta name="author" content="najahipro">
    <meta name="robots" content="index, follow">
    <meta name="language" content="Arabic">
    <meta name="geo.region" content="MA">
    <meta name="geo.country" content="Morocco">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="najahipro - حاسبة المعدل الدراسي المغربي">
    <meta property="og:description" content="احسب معدلك الدراسي بسهولة مع najahipro. مجاني ودقيق للنظام التعليمي المغربي.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://najahipro.github.io">
    <meta property="og:image" content="https://najahipro.github.io/icons/icon-512x512.png">
    <meta property="og:locale" content="ar_MA">
    <meta property="og:site_name" content="najahipro">
    
    <!-- Twitter Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="najahipro - حاسبة المعدل الدراسي">
    <meta name="twitter:description" content="احسب معدلك الدراسي بسهولة مع najahipro. مجاني للطلاب المغاربة.">
    <meta name="twitter:image" content="https://najahipro.github.io/icons/icon-512x512.png">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#667eea">
    <meta name="msapplication-TileColor" content="#667eea">
    <meta name="msapplication-TileImage" content="/icons/icon-144x144.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="najahipro">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" sizes="57x57" href="/icons/icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/icons/icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/icons/icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/icons/icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/icons/icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-180x180.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/icon-16x16.png">
    <link rel="shortcut icon" href="/favicon.ico">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Stylesheet -->
    <link rel="stylesheet" href="style.css">
    
    <!-- Google Analytics 4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        
        // ضع هنا ID ديال Google Analytics ديالك
        gtag('config', 'GA_MEASUREMENT_ID', {
            page_title: 'najahipro - حاسبة المعدل',
            page_location: window.location.href,
            custom_map: {
                'custom_parameter_1': 'education_tool'
            }
        });
        
        // تتبع أحداث مخصصة
        function trackEvent(eventName, parameters = {}) {
            gtag('event', eventName, {
                'app_name': 'najahipro',
                'screen_name': 'grade_calculator',
                ...parameters
            });
        }
    </script>
    
    <!-- Structured Data للـ SEO -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "najahipro - حاسبة المعدل الدراسي",
        "description": "حاسبة المعدل الدراسي الشاملة للنظام التعليمي المغربي",
        "url": "https://najahipro.github.io",
        "applicationCategory": "EducationalApplication",
        "operatingSystem": "Any",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "MAD"
        },
        "author": {
            "@type": "Organization",
            "name": "najahipro"
        },
        "inLanguage": "ar",
        "audience": {
            "@type": "EducationalAudience",
            "educationalRole": "student"
        },
        "educationalLevel": "secondary education",
        "about": {
            "@type": "Thing",
            "name": "حساب المعدل الدراسي"
        }
    }
    </script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-graduation-cap"></i> najahipro</h1>
            <p>حاسبة المعدل الدراسي الشاملة - النظام التعليمي المغربي</p>
            
            <!-- زر تثبيت PWA -->
            <div id="install-prompt" style="display: none; margin-top: 15px;">
                <button id="install-btn" class="btn btn-success">
                    <i class="fas fa-download"></i> ثبت التطبيق
                </button>
            </div>
        </div>

        <div class="card">
            <div class="selection-row">
                <div class="form-group">
                    <label for="level"><i class="fas fa-layer-group"></i> المستوى الدراسي:</label>
                    <select id="level">
                        <option value="">-- اختر المستوى --</option>
                        <option value="tc">الجذع المشترك</option>
                        <option value="1bac">السنة الأولى بكالوريا</option>
                        <option value="2bac">السنة الثانية بكالوريا</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="branch"><i class="fas fa-book-open"></i> الشعبة:</label>
                    <select id="branch" disabled>
                        <option value="">-- اختر الشعبة --</option>
                    </select>
                </div>
            </div>

            <div id="subjects-container">
                <table class="subjects-table" id="subjects-table" style="display: none;">
                    <thead>
                        <tr>
                            <th>المادة</th>
                            <th>الفرض 1</th>
                            <th>الفرض 2</th>
                            <th>الفرض 3</th>
                            <th>الفرض 4</th>
                            <th>الأنشطة المندمجة</th>
                            <th>المعامل</th>
                            <th>المعدل</th>
                            <th>إجراءات</th>
                        </tr>
                    </thead>
                    <tbody id="subjects-tbody">
                    </tbody>
                </table>
            </div>

            <!-- نموذج إضافة مادة جديدة -->
            <div class="add-subject-form" id="add-subject-form">
                <h3><i class="fas fa-plus"></i> إضافة مادة جديدة</h3>
                <div class="form-row">
                    <input type="text" id="new-subject-name" placeholder="اسم المادة" />
                    <input type="number" id="new-subject-coefficient" placeholder="المعامل" min="1" max="10" value="1" />
                </div>
                <div class="actions-row">
                    <button class="btn btn-success" id="add-subject-btn">
                        <i class="fas fa-check"></i> إضافة المادة
                    </button>
                    <button class="btn btn-secondary" id="cancel-add-btn">
                        <i class="fas fa-times"></i> إلغاء
                    </button>
                </div>
            </div>

            <div class="actions-row">
                <button class="btn btn-primary" id="calculate-btn" disabled>
                    <i class="fas fa-calculator"></i> احسب المعدل
                </button>
                <button class="btn btn-secondary" id="add-new-subject-btn">
                    <i class="fas fa-plus"></i> إضافة مادة
                </button>
                <button class="btn btn-secondary" id="clear-all-btn">
                    <i class="fas fa-trash"></i> مسح الكل
                </button>
                <button class="btn btn-secondary" id="export-btn">
                    <i class="fas fa-download"></i> تصدير البيانات
                </button>
            </div>

            <!-- قسم الإحصائيات -->
            <div class="stats-row" id="stats-row" style="display: none;">
                <div class="stat-card">
                    <div class="stat-value" id="total-subjects">0</div>
                    <div class="stat-label">عدد المواد</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="completed-subjects">0</div>
                    <div class="stat-label">مواد مكتملة</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="highest-grade">-</div>
                    <div class="stat-label">أعلى معدل</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="lowest-grade">-</div>
                    <div class="stat-label">أقل معدل</div>
                </div>
            </div>

            <!-- قسم النتيجة -->
            <div class="result-section" id="result-section">
                <div class="result-average" id="result-average">0.00</div>
                <div class="result-status" id="result-status">النتيجة</div>
                <div class="result-message" id="result-message">أدخل النقاط لحساب المعدل</div>
                
                <div class="result-details" id="result-details">
                    <h3>تفاصيل النتائج:</h3>
                    <div id="subject-details"></div>
                </div>
            </div>
        </div>

        <!-- معلومات إضافية -->
        <div class="card">
            <h3><i class="fas fa-info-circle"></i> معلومات مهمة</h3>
            <div class="info-grid">
                <div class="info-item">
                    <h4>طريقة حساب المعدل:</h4>
                    <p>المعدل = مجموع (النقطة × المعامل) ÷ مجموع المعاملات</p>
                </div>
                <div class="info-item">
                    <h4>معدل النجاح:</h4>
                    <p>10/20 كحد أدنى للنجاح في النظام التعليمي المغربي</p>
                </div>
                <div class="info-item">
                    <h4>حساب معدل المادة:</h4>
                    <p>معدل المادة = (مجموع الفروض + الأنشطة المندمجة) ÷ عدد التقييمات</p>
                </div>
                <div class="info-item">
                    <h4>ثبت التطبيق:</h4>
                    <p>يمكنك تثبيت najahipro على هاتفك واستخدامه بدون انترنت!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- PWA Installation Script -->
    <script>
        // PWA Installation
        let deferredPrompt;
        const installBtn = document.getElementById('install-btn');
        const installPrompt = document.getElementById('install-prompt');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installPrompt.style.display = 'block';
            
            // Track event
            if (typeof trackEvent === 'function') {
                trackEvent('pwa_install_prompt_shown');
            }
        });

        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                
                if (outcome === 'accepted') {
                    console.log('✅ PWA installed');
                    if (typeof trackEvent === 'function') {
                        trackEvent('pwa_installed');
                    }
                } else {
                    console.log('❌ PWA installation declined');
                    if (typeof trackEvent === 'function') {
                        trackEvent('pwa_install_declined');
                    }
                }
                
                deferredPrompt = null;
                installPrompt.style.display = 'none';
            }
        });

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const registration = await navigator.serviceWorker.register('/sw.js');
                    console.log('✅ SW registered successfully');
                    
                    if (typeof trackEvent === 'function') {
                        trackEvent('service_worker_registered');
                    }
                    
                    // Update available
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                // Show update available notification
                                showUpdateNotification();
                            }
                        });
                    });
                    
                } catch (error) {
                    console.log('❌ SW registration failed:', error);
                    if (typeof trackEvent === 'function') {
                        trackEvent('service_worker_failed', { error: error.message });
                    }
                }
            });
        }

        function showUpdateNotification() {
            const notification = document.createElement('div');
            notification.innerHTML = `
                <div style="position: fixed; top: 20px; right: 20px; background: #667eea; color: white; padding: 15px; border-radius: 8px; z-index: 9999; box-shadow: 0 4px 12px rgba(0,0,0,0.3);">
                    <p style="margin: 0 0 10px 0;">تحديث جديد متوفر!</p>
                    <button onclick="updateApp()" style="background: white; color: #667eea; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">تحديث الآن</button>
                    <button onclick="this.parentElement.parentElement.remove()" style="background: transparent; color: white; border: 1px solid white; padding: 5px 10px; border-radius: 4px; cursor: pointer; margin-right: 5px;">لاحقاً</button>
                </div>
            `;
            document.body.appendChild(notification);
        }

        function updateApp() {
            if (navigator.serviceWorker.controller) {
                navigator.serviceWorker.controller.postMessage({ type: 'SKIP_WAITING' });
                window.location.reload();
            }
        }

        // Enhanced Analytics Tracking
        function trackCalculation(average, level, branch) {
            if (typeof trackEvent === 'function') {
                trackEvent('grade_calculated', {
                    average: Math.round(average),
                    level: level,
                    branch: branch,
                    success: average >= 10
                });
            }
        }

        function trackSubjectAdded(subjectName) {
            if (typeof trackEvent === 'function') {
                trackEvent('custom_subject_added', {
                    subject_name: subjectName
                });
            }
        }

        function trackDataExport() {
            if (typeof trackEvent === 'function') {
                trackEvent('data_exported');
            }
        }
    </script>

    <script src="scripts1.js"></script>
</body>
</html>